<html>

<head>
<link rel="stylesheet" href="/css/demo.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jstree/3.3.7/themes/default/style.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jstree/3.3.7/jstree.min.js"></script>
</head>

<body>
<table>
<tr><td><a href="/portal"><img alt="logo" width="144" height="144" src="/img/logo.png"></a></td><tr>
</table>


<h1>List Files</h1>

<p/>

<table>
<tr class="gray">
    <td style=".owner">$addr.label</td>
    <td>$addr.address</td>
    <td>$addr.balance</td>
    <td><a href="/portal/rmaddr?addr=$addr.address">unregister</a></td>
</tr>
</table>

<form action="/portal/padd">
<input type="hidden" name="addr" value="$addr.address">
<input type="submit" value="Add Content">
</form>

<h2>IPFS files</h2>
<div id="treeIpfs"></div>

<h2>Local files</h2>
<div id="treeLocal"></div>

<script>

$(function() {

  $('#treeIpfs').jstree({
    'core' : $treeDataIpfs,
    'plugins': ["contextmenu"],
    "contextmenu": {         
        "show_at_node": false,       
        "items": treeMenuIpfs
    }
  });

  $('#treeLocal').jstree({
    'core' : $treeDataLocal,
    'plugins': ["contextmenu"],
    "contextmenu": {  
        "show_at_node": false,       
        "items": treeMenuLocal
    }
  });
});

function treeMenuIpfs(node) {

    // Directory items have no context menu
    if (node.children.length > 0) {
        return "";
    }
    
    var jstree = $('#treeIpfs').jstree(true);
    var data = jstree.get_selected(true)[0].data;
    console.log("treeIpfs: " + data);
        
    var items = {
        "show": {
            "label": "show",
            "action": function (obj) { 
                var href = "$gatewayUrl/" + data.cid;
                window.open(href); 
                }
        },
        "get": {
            "label": "get",
            "action": function (obj) { 
                var href = "/portal/pget?addr=" + data.addr + "&path=" + data.path + "&cid=" + data.cid;
                window.open(href, "_self"); 
                }
        },
        "send": {
            "label": "send",
            "action": function (obj) { 
                var href = "/portal/psend?addr=" + data.addr + "&path=" + data.path + "&cid=" + data.cid;
                window.open(href, "_self"); 
                }
        },
        "remove": {
            "label": "remove",
            "action": function (obj) { 
                var href = "/portal/rmipfs?addr=" + data.addr + "&cids=" + data.cid;
                window.open(href, "_self"); 
            }
        }
    }

    return items;
}

function treeMenuLocal(node) {

    // Directory items have no context menu
    if (node.children.length > 0) {
        return "";
    }
    
    var jstree = $('#treeLocal').jstree(true);
    var data = jstree.get_selected(true)[0].data;
    console.log("treeLocal: " + data);
    
    var items = {
        "show": {
            "label": "show",
            "action": function (obj) { 
                var href = "/portal/fshow?addr=" + data.addr + "&path=" + data.path;
                window.open(href); 
                }
        },
        "remove": {
            "label": "remove",
            "action": function (obj) { 
                var href = "/portal/rmlocal?addr=" + data.addr + "&path=" + data.path;
                window.open(href, "_self"); 
            }
        }
    }

    return items;
}
</script>

</body>
</html>
